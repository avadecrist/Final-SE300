<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SmartStoreApplication.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">final</a> &gt; <a href="index.source.html" class="el_package">com.se300.store</a> &gt; <span class="el_source">SmartStoreApplication.java</span></div><h1>SmartStoreApplication.java</h1><pre class="source lang-java linenums">package com.se300.store;

import com.se300.store.controller.StoreController;
import com.se300.store.controller.UserController;
import com.se300.store.data.DataManager;
import com.se300.store.repository.StoreRepository;
import com.se300.store.repository.UserRepository;
import com.se300.store.service.AuthenticationService;
import com.se300.store.service.StoreService;
import org.apache.catalina.Context;
import org.apache.catalina.LifecycleException;
import org.apache.catalina.startup.Tomcat;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.File;

/**
 * SmartStoreApplication - Main application class.
 *
 * @author Sergey L. Sundukovskiy, Ph.D.
 * @version 1.0
 */
<span class="fc" id="L24">public class SmartStoreApplication {</span>

<span class="fc" id="L26">    private static final Logger logger = LoggerFactory.getLogger(SmartStoreApplication.class);</span>
    private static final int PORT = 8080;

    private Tomcat tomcat;

    /**
     * Main method - application entry point.
     */
    public static void main(String[] args) {
<span class="nc" id="L35">        SmartStoreApplication app = new SmartStoreApplication();</span>
        try {
<span class="nc" id="L37">            app.start();</span>
<span class="nc" id="L38">        } catch (Exception e) {</span>
<span class="nc" id="L39">            logger.error(&quot;Failed to start application&quot;, e);</span>
<span class="nc" id="L40">            System.exit(1);</span>
<span class="nc" id="L41">        }</span>
<span class="nc" id="L42">    }</span>

    /**
     * Starts the application.
     * Demonstrates the complete application lifecycle.
     * Blocks until server shutdown (suitable for main application).
     */
    public void start() throws LifecycleException {
<span class="nc" id="L50">        startServer(true); // blocking mode</span>
<span class="nc" id="L51">    }</span>

    /**
     * Starts the application without blocking.
     * Suitable for testing where you need the server running but want to continue execution.
     */
    public void startNonBlocking() throws LifecycleException {
<span class="fc" id="L58">        startServer(false); // non-blocking mode</span>
<span class="fc" id="L59">    }</span>

    /**
     * Internal method to start the server with optional blocking.
     *
     * @param block if true, blocks until server shutdown; if false, returns immediately
     */
    private void startServer(boolean block) throws LifecycleException {
<span class="fc" id="L67">        logger.info(&quot;Starting Smart Store Application...&quot;);</span>

        // Step 1: Initialize database
<span class="fc" id="L70">        logger.info(&quot;Initializing database...&quot;);</span>
<span class="fc" id="L71">        DataManager dataManager = DataManager.getInstance();</span>

        // Step 2: Create repositories (Data Access Layer)
<span class="fc" id="L74">        logger.info(&quot;Creating repositories...&quot;);</span>
<span class="fc" id="L75">        StoreRepository storeRepository = new StoreRepository(dataManager);</span>
<span class="fc" id="L76">        UserRepository userRepository = new UserRepository(dataManager);</span>

        // Step 3: Create services (Business Logic Layer)
<span class="fc" id="L79">        logger.info(&quot;Creating services...&quot;);</span>
<span class="fc" id="L80">        StoreService storeService = new StoreService(storeRepository);</span>
<span class="fc" id="L81">        AuthenticationService userService = new AuthenticationService(userRepository);</span>

        // Step 4: Create controllers (Presentation Layer)
<span class="fc" id="L84">        logger.info(&quot;Creating controllers...&quot;);</span>
<span class="fc" id="L85">        StoreController storeController = new StoreController(storeService);</span>
<span class="fc" id="L86">        UserController userController = new UserController(userService);</span>

        // Step 5: Configure and start Tomcat
<span class="fc" id="L89">        logger.info(&quot;Configuring Tomcat server...&quot;);</span>
<span class="fc" id="L90">        tomcat = new Tomcat();</span>
<span class="fc" id="L91">        tomcat.setPort(PORT);</span>
<span class="fc" id="L92">        tomcat.getConnector(); // Initialize default connector</span>

        // Create context
<span class="fc" id="L95">        String contextPath = &quot;&quot;;</span>
<span class="fc" id="L96">        String docBase = new File(&quot;.&quot;).getAbsolutePath();</span>
<span class="fc" id="L97">        Context context = tomcat.addContext(contextPath, docBase);</span>

        // Register Store Controller servlet
<span class="fc" id="L100">        Tomcat.addServlet(context, &quot;storeController&quot;, storeController);</span>
<span class="fc" id="L101">        context.addServletMappingDecoded(&quot;/api/v1/stores/*&quot;, &quot;storeController&quot;);</span>

        // Register User Controller servlet
<span class="fc" id="L104">        Tomcat.addServlet(context, &quot;userController&quot;, userController);</span>
<span class="fc" id="L105">        context.addServletMappingDecoded(&quot;/api/v1/users/*&quot;, &quot;userController&quot;);</span>

        // Step 6: Start Tomcat
<span class="fc" id="L108">        tomcat.start();</span>

<span class="fc" id="L110">        logger.info(&quot;=&quot;.repeat(80));</span>
<span class="fc" id="L111">        logger.info(&quot;Smart Store Application started successfully!&quot;);</span>
<span class="fc" id="L112">        logger.info(&quot;=&quot;.repeat(80));</span>
<span class="fc" id="L113">        logger.info(&quot;Server running on: http://localhost:{}&quot;, PORT);</span>
<span class="fc" id="L114">        logger.info(&quot;&quot;);</span>
<span class="fc" id="L115">        logger.info(&quot;Available endpoints:&quot;);</span>
<span class="fc" id="L116">        logger.info(&quot;  - API:            http://localhost:{}/api/v1/stores&quot;, PORT);</span>
<span class="fc" id="L117">        logger.info(&quot;  - API:            http://localhost:{}/api/v1/users&quot;, PORT);</span>
<span class="fc" id="L118">        logger.info(&quot;=&quot;.repeat(80));</span>

        // Add shutdown hook
<span class="fc" id="L121">        Runtime.getRuntime().addShutdownHook(new Thread(this::shutdown));</span>

        // Keep the server running (only if blocking mode)
<span class="pc bpc" id="L124" title="1 of 2 branches missed.">        if (block) {</span>
<span class="nc" id="L125">            tomcat.getServer().await();</span>
        }
<span class="fc" id="L127">    }</span>

    /**
     * Stops the server.
     * Useful for testing scenarios where you need to explicitly stop the server.
     */
    public void stop() throws LifecycleException {
<span class="pc bpc" id="L134" title="1 of 2 branches missed.">        if (tomcat != null) {</span>
<span class="fc" id="L135">            tomcat.stop();</span>
        }
<span class="fc" id="L137">    }</span>


    /**
     * Shuts down the application gracefully.
     *
     * NOTE: We do NOT close the DatabaseManager here because it's a singleton
     * shared across the application (and test classes). Closing it would break
     * other tests or application components. DatabaseManager has its own shutdown
     * hook to close when the JVM exits.
     */
    private void shutdown() {
<span class="fc" id="L149">        logger.info(&quot;Shutting down Commission Calculator Integration Application...&quot;);</span>

        try {
<span class="pc bpc" id="L152" title="1 of 2 branches missed.">            if (tomcat != null) {</span>
<span class="fc" id="L153">                tomcat.stop();</span>
<span class="fc" id="L154">                tomcat.destroy();</span>
            }

<span class="fc" id="L157">            logger.info(&quot;Application shut down successfully&quot;);</span>
<span class="nc" id="L158">        } catch (Exception e) {</span>
<span class="nc" id="L159">            logger.error(&quot;Error during shutdown&quot;, e);</span>
<span class="fc" id="L160">        }</span>
<span class="fc" id="L161">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>